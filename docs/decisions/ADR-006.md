# ADR-006: Estimativa de Custos de Infraestrutura

- **Status**: Draft
- **Context Timestamp**: 2025-10-13

## Contexto
O MVP roda em host único com Docker Compose (ADR-000). Precisamos estimar custos mensais para planejar orçamento de MVP, piloto e produção inicial, considerando serviços self-hosted e APIs externas.

## Premissas
- Host dedicado (cloud) com 4 vCPU, 8 GB RAM, 200 GB SSD — ~USD 60/mês.
- Evolution API v2 licenciada gratuitamente para MVP (self-host).
- OpenAI `gpt-4o-mini` para respostas (USD 0.003 por saída e 0.0015 por entrada por 1K tokens).
- Volume diário previsto: 200 conversas com 20 mensagens cada (~750 tokens conversa).
- 10% das conversas geram pedido de orçamento (tráfego para integrações).

## Estimativa Mensal
| Item | Premissa | Custo estimado |
| --- | --- | --- |
| Servidor (compute + disco) | VPS 4vCPU/8GB | **USD 60** |
| OpenAI completions | 200 conv/dia × 20 msg (750 tokens) × USD 0.0045/1K | **USD 81** |
| OpenAI embeddings | 300 documentos/dia × 750 tokens × USD 0.00013/1K | **USD 8.8** |
| Redis cache | Incluso no host | **USD 0** |
| RabbitMQ | Incluso no host | **USD 0** |
| Postgres storage backups | Snapshots 50 GB (USD 0.10/GB) | **USD 5** |
| Watchtower/Monitoring | Incluso | **USD 0** |
| Contingência (20%) | Imprevistos, tráfego acima do previsto | **USD 31** |
| **Total estimado** |  | **USD 185/mês** |

## Decisão
Reservar budget inicial de **USD 200/mês** cobrindo compute, armazenamento e consumo OpenAI. Reavaliar ao entrar em piloto (maior volume e possíveis integrações pagas).

## Consequências
- Positivo: fornece baseline para decisões de pricing e ROI do MVP.
- Positivo: identifica itens gratuitos (Redis, RabbitMQ) enquanto rodarmos self-host.
- Risco: custos OpenAI variam com tokens e upgrades de modelo; valores devem ser monitorados semanalmente.
- Mitigação: implementar alertas no módulo de custos (T-???), ajustar prompts e fallback para modelos mais baratos conforme uso real.

## Follow-up
- [ ] Criar planilha detalhada (OPEX) com faixas de volume (100/500/1000 conversas).
- [ ] Adicionar monitoramento de tokens e custo diário no dashboard de métricas.
- [ ] Revisar orçamento ao habilitar TTS/STT (custos adicionais).
