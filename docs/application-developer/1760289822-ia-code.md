## 1. Contexto consumido
- `docs/application-developer/README.md` ✅
- `docs/application-developer/pre-flight.md` ✅
- `docs/application-developer/context-index.md` ✅
- `docs/application-developer/1760289717-ia-code.md` ✅
- `docs/application-developer/anonymization-job.md` ✅
- `db/migrations/0010_audit_retention.sql` ✅

## 2. Objetivo da alteração
Implementar job de anonimização PII (T-046) que executa políticas definidas em `audit_retention` e gera relatório de linhas afetadas.

## 3. Decisões e justificativas
- `fn_apply_retention_scrub()` percorre políticas ativas, aplica anonimização em `contacts` (hash do telefone + remoção do nome) e sanitiza conteúdo de `messages` conforme cutoff.
- Script `tools/apply-retention.sh` executa a função e imprime os resultados; documentação em `docs/application-developer/anonymization-job.md` orienta uso.

## 4. Implementação
- Arquivos tocados: `db/migrations/0011_retention_job.sql`, `tools/apply-retention.sh`, `docs/application-developer/anonymization-job.md`, `docs/application-developer/pre-flight.md`.
- Estratégia de testes/validação: executar a função em ambiente com dados fictícios para confirmar valores retornados (não executado aqui).

## 5. Pontos que precisam de revisão humana
- Confirmar escopos adicionais (anexos, audit_log) e ajustar a função; revisar pesos de anonimização.

## 6. Follow-ups recomendados
- Registrar execuções em `audit_retention_log` (T-046/T-047 dependentes).
- Automatizar job (cron/CI) e alertas para falhas.
