## 1. Contexto consumido
- `docs/application-developer/README.md` ✅
- `docs/application-developer/pre-flight.md` ✅
- `docs/application-developer/context-index.md` ✅
- `docs/application-developer/1760292630-ia-code.md` ✅
- `docs/application-developer/response-latency.md` ✅
- `db/migrations/0018_response_latency.sql` ✅

## 2. Objetivo da alteração
Registrar e medir latência ponta-a-ponta em `fact_response`, atendendo à tarefa T-065.

## 3. Decisões e justificativas
- Função `fn_register_response_latency` calcula `response_time_ms` (ms) a partir de timestamps e faz upsert idempotente em `fact_response`.
- View `metrics_response_latency` agrega métricas diárias (avg, p50, p95, samples).
- Teste SQL assegura cálculo esperado.

## 4. Implementação
- Arquivos tocados: `db/migrations/0018_response_latency.sql`, `db/tests/response_latency.sql`, `docs/application-developer/response-latency.md`, `docs/application-developer/pre-flight.md`.
- Estratégia de testes/validação: script `response_latency.sql` garante latência ≈ 4s.

## 5. Pontos que precisam de revisão humana
- Ajustar função caso haja timezone/clock drift; considerar dados negativos.

## 6. Follow-ups recomendados
- Chamar função a partir do handler SEND_MESSAGE para registrar latência real.
